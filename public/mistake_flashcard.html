<!DOCTYPE html>
<html class="dark" lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>é€Ÿåˆ·å•è¯ - åˆ·é”™è¯</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#f59e0b",
                        "accent-teal": "#26c6da",
                        "background-dark": "#1e212f",
                        "card-dark": "#2d3248",
                        "surface-dark": "#2d3446",
                    },
                    fontFamily: {
                        display: ["Inter", "system-ui", "sans-serif"],
                    },
                    borderRadius: {
                        DEFAULT: "12px",
                        'pill': "9999px",
                    },
                },
            },
        };
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .word-card {
            transition: all 0.3s ease;
        }

        .word-card.slide-out-left {
            transform: translateX(-120%);
            opacity: 0;
        }

        .word-card.slide-out-right {
            transform: translateX(120%);
            opacity: 0;
        }

        .word-card.slide-in {
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(50%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .detail-card {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-background-dark text-slate-100 min-h-screen flex flex-col">
    <!-- Header -->
    <header class="px-6 flex items-center justify-between h-14 mt-4">
        <div class="flex items-center gap-4">
            <button onclick="goBack()" class="text-slate-400 hover:text-white">
                <span class="material-icons-round text-2xl">chevron_left</span>
            </button>
            <span id="progress" class="text-sm font-medium text-slate-400">0/0</span>
        </div>
        <div class="flex items-center gap-5">
            <button onclick="speakWord()" class="text-slate-400 hover:text-white">
                <span class="material-icons-round text-xl">volume_up</span>
            </button>
            <button onclick="toggleFullscreen()" class="text-slate-400 hover:text-white">
                <span id="fullscreenIcon" class="material-icons-round text-xl">fullscreen</span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main id="cardContainer" class="flex-1 px-8 pt-10 flex flex-col overflow-y-auto">
        <!-- å•è¯å¡ç‰‡ï¼ˆé—®ç­”æ¨¡å¼ï¼‰ -->
        <div id="wordCard" class="word-card">
            <h1 id="wordText" class="text-5xl font-bold mb-4 tracking-tight text-white cursor-pointer"
                onclick="speakWord()">
                Loading...
            </h1>
            <div class="flex items-center gap-3 mb-10">
                <button onclick="speakWord()"
                    class="flex items-center gap-1.5 bg-white/10 px-3 py-1 rounded-md hover:bg-white/20 transition-colors">
                    <span class="text-xs font-bold text-slate-300">ç¾</span>
                    <span class="material-icons-round text-sm text-slate-300">volume_up</span>
                </button>
            </div>
        </div>

        <!-- å•è¯è¯¦æƒ…å¡ç‰‡ï¼ˆç‚¹å‡»ä¸è®¤è¯†åæ˜¾ç¤ºï¼‰ -->
        <div id="detailCard" class="detail-card hidden">
            <h1 id="detailWord" class="text-4xl font-bold mb-2 tracking-tight text-white cursor-pointer"
                onclick="playDictAudio()">
                word
            </h1>
            <div class="flex items-center gap-3 mb-4">
                <span id="phonetic" class="text-slate-400 text-sm">/ËˆwÉœËrd/</span>
                <button onclick="playDictAudio()"
                    class="flex items-center gap-1.5 bg-white/10 px-3 py-1 rounded-md hover:bg-white/20 transition-colors">
                    <span class="text-xs font-bold text-slate-300">ç¾</span>
                    <span class="material-icons-round text-sm text-slate-300">volume_up</span>
                </button>
            </div>

            <!-- é‡Šä¹‰åŒºåŸŸ -->
            <div id="definitionArea" class="mb-4 space-y-3">
                <div class="text-slate-400 text-sm">æ­£åœ¨åŠ è½½é‡Šä¹‰...</div>
            </div>

            <!-- ä¾‹å¥åŒºåŸŸ -->
            <div id="exampleArea" class="hidden mb-4 bg-card-dark rounded-xl p-4">
                <div class="flex items-start gap-2">
                    <span class="material-icons-round text-accent-teal text-sm mt-1">format_quote</span>
                    <div>
                        <p id="exampleText" class="text-slate-200 text-sm mb-1"></p>
                    </div>
                </div>
            </div>

            <!-- åˆ·é”™è¯æ¨¡å¼ä¸éœ€è¦â€œå·²åŠ å…¥é”™è¯æœ¬â€æç¤º -->
        </div>

        <!-- å®Œæˆæç¤º -->
        <div id="completedCard" class="hidden flex-1 flex flex-col items-center justify-center text-center pb-20">
            <!-- å›¾æ ‡/å›¾ç‰‡ area -->
            <div class="mb-6 relative">
                <span class="material-icons-round text-8xl text-primary/80">beach_access</span>
            </div>

            <h2 class="text-2xl font-bold mb-8 tracking-wide text-white">æœ¬ç»„å•è¯å·²åˆ·å®Œ</h2>

            <!-- ç»Ÿè®¡æ•°æ® -->
            <div class="flex items-center gap-8 mb-12">
                <div class="flex items-center gap-1">
                    <span id="sessionKnown" class="text-3xl font-bold text-emerald-400">0</span>
                    <span
                        class="material-icons-round text-emerald-500 text-sm bg-emerald-500/20 rounded-full p-0.5">check</span>
                </div>
                <div class="w-px h-8 bg-slate-700"></div>
                <div class="flex items-center gap-1">
                    <span id="sessionUnknown" class="text-3xl font-bold text-primary">0</span>
                    <span
                        class="material-icons-round text-primary text-sm bg-primary/20 rounded-full p-0.5">close</span>
                </div>
            </div>

            <!-- åº•éƒ¨å‰©ä½™æç¤ºå’ŒæŒ‰é’® -->
            <div class="fixed bottom-8 left-0 right-0 px-6 w-full max-w-lg mx-auto flex flex-col items-center gap-4">
                <p id="remainingText" class="text-sm text-slate-500 mb-2">è¿˜å‰© 0 è¯</p>
                <div class="flex gap-4 w-full">
                    <button onclick="continueNextBatch()"
                        class="flex-1 bg-primary text-white rounded-full py-4 text-base font-bold shadow-lg shadow-primary/20 hover:brightness-110 active:scale-[0.98] transition-all">
                        ç»§ç»­åˆ·
                    </button>
                    <button onclick="window.location.href='/dashboard'"
                        class="flex-1 border border-slate-600 text-slate-300 rounded-full py-4 text-base font-medium hover:bg-white/5 active:scale-[0.98] transition-all">
                        ä¼‘æ¯ä¸€ä¸‹
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer Buttons - åˆå§‹é—®ç­”æ¨¡å¼ -->
    <footer id="actionButtons"
        class="fixed bottom-0 left-0 right-0 p-4 pb-8 flex gap-4 bg-gradient-to-t from-background-dark via-background-dark to-transparent z-50">
        <button id="btnKnown" onclick="markKnown()"
            class="flex-1 flex flex-col items-center gap-2 group active:scale-95 transition-transform">
            <span class="text-lg font-medium text-white">è®¤è¯†</span>
            <div class="h-1.5 w-8 rounded-full bg-emerald-500 shadow-[0_0_12px_rgba(16,185,129,0.5)]"></div>
        </button>
        <button id="btnUnknown" onclick="markUnknown()"
            class="flex-1 flex flex-col items-center gap-2 group active:scale-95 transition-transform">
            <span class="text-lg font-medium text-white">ä¸è®¤è¯†</span>
            <div class="h-1.5 w-8 rounded-full bg-rose-500 shadow-[0_0_12px_rgba(244,63,94,0.5)]"></div>
        </button>
    </footer>

    <!-- Footer Buttons - ä¸è®¤è¯†è¯¦æƒ…æ¨¡å¼ï¼ˆåªæœ‰ä¸‹ä¸€è¯ï¼‰ -->
    <footer id="unknownDetailButtons"
        class="hidden fixed bottom-0 left-0 right-0 p-4 pb-8 flex items-center justify-center gap-4 bg-gradient-to-t from-background-dark via-background-dark to-transparent z-50">
        <button onclick="goToNextWord()"
            class="flex flex-col items-center gap-2 group active:scale-95 transition-transform">
            <span class="text-lg font-medium text-accent-teal">ä¸‹ä¸€è¯</span>
            <div class="h-1.5 w-12 rounded-full bg-accent-teal shadow-[0_0_12px_rgba(38,198,218,0.5)]"></div>
        </button>
    </footer>

    <!-- Footer Buttons - è®¤è¯†è¯¦æƒ…æ¨¡å¼ï¼ˆä¸‹ä¸€è¯ï¼Œè®°é”™äº†ï¼‰ -->
    <footer id="knownDetailButtons"
        class="hidden fixed bottom-0 left-0 right-0 p-4 pb-8 flex gap-4 bg-gradient-to-t from-background-dark via-background-dark to-transparent z-50">
        <button onclick="goToNextWord()"
            class="flex-1 flex flex-col items-center gap-2 group active:scale-95 transition-transform">
            <span class="text-lg font-medium text-accent-teal">ä¸‹ä¸€è¯</span>
            <div class="h-1.5 w-8 rounded-full bg-accent-teal shadow-[0_0_12px_rgba(38,198,218,0.5)]"></div>
        </button>
        <button onclick="markAsMistake()"
            class="flex-1 flex flex-col items-center gap-2 group active:scale-95 transition-transform">
            <span class="text-lg font-medium text-rose-400">è®°é”™äº†</span>
            <div class="h-1.5 w-8 rounded-full bg-rose-500 shadow-[0_0_12px_rgba(244,63,94,0.5)]"></div>
        </button>
    </footer>


    <script>
        // å›ºå®šä¸ºé”™è¯æ¨¡å¼
        const mode = 'mistakes';

        // å…¼å®¹åŸæœ‰çš„å…¨å±€å˜é‡
        let currentWord = null;
        let isShowingDetail = false;

        // åˆ†ç»„å­¦ä¹ é…ç½®
        const BATCH_SIZE = 20;
        let sessionCount = 0;
        let currentBatchTarget = BATCH_SIZE;

        // ç»Ÿè®¡æ•°æ®
        let sessionKnownCount = 0;
        let sessionUnknownCount = 0;
        let remainingMistakes = 0;

        // è¿”å›ä¸Šä¸€é¡µ
        function goBack() {
            if (sessionCount < currentBatchTarget && sessionCount > 0 && currentWord) {
                const remaining = currentBatchTarget - sessionCount;
                if (!confirm(`æœ¬ç»„é”™è¯è¿˜å‰© ${remaining} ä¸ªæœªå¤ä¹ ã€‚\n\nç°åœ¨é€€å‡ºä¸‹æ¬¡å°†å¼€å¯æ–°ä¸€ç»„ï¼Œç¡®å®šè¦é€€å‡ºå—ï¼Ÿ`)) {
                    return;
                }
            }

            if (isShowingDetail) {
                hideDetail();
                loadNextWord();
            } else {
                window.location.href = '/dashboard';
            }
        }

        // å‘éŸ³
        let audioPlayer = null;
        let cachedAudioPath = null;

        function speakWord() {
            if (!currentWord) return;

            if (audioPlayer) {
                audioPlayer.pause();
                audioPlayer = null;
            }

            let audioUrl;
            if (cachedAudioPath) {
                audioUrl = cachedAudioPath;
            } else {
                audioUrl = `https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(currentWord.word)}&type=2`;
            }

            audioPlayer = new Audio(audioUrl);
            audioPlayer.play().catch(err => {
                console.log('æ’­æ”¾å¤±è´¥', err);
            });
        }

        // åŠ è½½ä¸‹ä¸€ä¸ªé”™è¯
        async function loadNextWord() {
            // æ£€æŸ¥ç»„ä»»åŠ¡
            if (sessionCount >= currentBatchTarget) {
                showBatchCompleted();
                return;
            }

            const endpoint = '/api/mistakes/next';

            try {
                const res = await fetch(endpoint);
                if (!res.ok) {
                    // å¦‚æœæ˜¯401æœªç™»å½•ï¼Œè·³è½¬ç™»å½•
                    if (res.status === 401) {
                        alert('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
                        window.location.href = '/';
                        return;
                    }
                    throw new Error(`API Error: ${res.status}`);
                }
                const data = await res.json();

                if (data.completed) {
                    showCompleted();
                    return;
                }

                if (!data.word) throw new Error('æœªè·å–åˆ°å•è¯æ•°æ®');

                // åªæœ‰ç¬¬ä¸€å¼ å¡æ‰è°ƒæ•´ç›®æ ‡ï¼Œé¿å…ä¸­é€”å˜åŠ¨
                if (sessionCount === 0 && data.remaining !== undefined) {
                    // data.remaining æ˜¯æ•°æ®åº“é‡Œçš„ total count (api/mistakes/next)
                    currentBatchTarget = Math.min(BATCH_SIZE, data.remaining);
                    remainingMistakes = data.remaining; // åˆå§‹å‰©ä½™
                } else if (data.remaining !== undefined) {
                    remainingMistakes = data.remaining;
                }

                currentWord = data.word;
                isShowingDetail = false;
                cachedAudioPath = null;

                // é¢„åŠ è½½è¯¦æƒ…å’ŒéŸ³é¢‘
                preLoadDictionary(currentWord.word);

                // æ›´æ–°è¿›åº¦
                document.getElementById('progress').textContent = `æœ¬ç»„è¿›åº¦ ${sessionCount + 1}/${currentBatchTarget}`;

                // åŠ¨ç”»
                const card = document.getElementById('wordCard');
                card.classList.remove('slide-in', 'hidden');

                document.getElementById('wordText').textContent = currentWord.word;
                document.getElementById('wordText').classList.remove('text-base', 'text-rose-400');

                void card.offsetWidth;
                card.classList.add('slide-in');

                showQuizButtons();

                // è‡ªåŠ¨å‘éŸ³
                setTimeout(speakWord, 300);

            } catch (error) {
                console.error('åŠ è½½å•è¯å¤±è´¥:', error);
                document.getElementById('wordText').textContent = 'åŠ è½½å¤±è´¥: ' + error.message;
                document.getElementById('wordText').classList.add('text-base', 'text-rose-400');
                // å¯é€‰ï¼šalert('åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–é‡è¯•');
            }
        }

        function showBatchCompleted() {
            document.getElementById('wordCard').classList.add('hidden');
            document.getElementById('detailCard').classList.add('hidden');
            document.getElementById('actionButtons').classList.add('hidden');
            document.getElementById('unknownDetailButtons').classList.add('hidden');
            document.getElementById('knownDetailButtons').classList.add('hidden');

            const completedCard = document.getElementById('completedCard');
            completedCard.classList.remove('hidden');

            const title = completedCard.querySelector('h2');
            if (title) title.textContent = 'ğŸ‰ æœ¬ç»„é”™è¯å¤ä¹ å®Œæˆï¼';

            // å¡«å……æ•°æ®
            if (document.getElementById('sessionKnown')) {
                document.getElementById('sessionKnown').textContent = sessionKnownCount;
                document.getElementById('sessionUnknown').textContent = sessionUnknownCount;
            }
            if (document.getElementById('remainingText')) {
                document.getElementById('remainingText').textContent = `è¿˜å‰© ${Math.max(0, remainingMistakes - 1)} è¯`;
            }

            // ç¡®ä¿æŒ‰é’®æ˜¾ç¤ºæ­£ç¡®
            const continueBtn = completedCard.querySelector('button[onclick="continueNextBatch()"]');
            if (continueBtn) continueBtn.classList.remove('hidden');
        }

        function continueNextBatch() {
            sessionCount = 0;
            currentBatchTarget = BATCH_SIZE; // è¿™é‡Œå…¶å®ä¼šè¢« loadNextWord çš„ remaining è¦†ç›–ï¼Œä½†å…ˆé‡ç½®ä¸ºé»˜è®¤
            sessionKnownCount = 0;
            sessionUnknownCount = 0;

            document.getElementById('completedCard').classList.add('hidden');
            loadNextWord();
        }

        async function preLoadDictionary(word) {
            try {
                const res = await fetch(`/api/dict/${encodeURIComponent(word)}`);
                if (res.ok) {
                    const data = await res.json();
                    if (data.audio) cachedAudioPath = data.audio;
                }
            } catch (e) {
                console.error('é¢„åŠ è½½å¤±è´¥', e);
            }
        }

        function showQuizButtons() {
            document.getElementById('detailCard').classList.add('hidden');
            document.getElementById('wordCard').classList.remove('hidden');
            document.getElementById('unknownDetailButtons').classList.add('hidden');
            document.getElementById('knownDetailButtons').classList.add('hidden');
            document.getElementById('actionButtons').classList.remove('hidden');
        }

        let isKnownMode = false;

        async function showDetail(isKnown = false) {
            isShowingDetail = true;
            isKnownMode = isKnown;

            document.getElementById('wordCard').classList.add('hidden');
            document.getElementById('detailCard').classList.remove('hidden');
            document.getElementById('detailWord').textContent = currentWord.word;

            document.getElementById('actionButtons').classList.add('hidden');
            document.getElementById('unknownDetailButtons').classList.add('hidden');
            document.getElementById('knownDetailButtons').classList.add('hidden');

            if (isKnown) {
                document.getElementById('knownDetailButtons').classList.remove('hidden');
            } else {
                document.getElementById('unknownDetailButtons').classList.remove('hidden');
            }
            // ä¸éœ€è¦æ˜¾ç¤º mistakeTip

            document.getElementById('phonetic').textContent = '';
            document.getElementById('definitionArea').innerHTML = '<div class="text-slate-400 text-sm">æ­£åœ¨åŠ è½½é‡Šä¹‰...</div>';
            document.getElementById('exampleArea').classList.add('hidden');

            await loadDictionary(currentWord.word);
        }

        function hideDetail() {
            isShowingDetail = false;
            isKnownMode = false;
            document.getElementById('detailCard').classList.add('hidden');
            document.getElementById('unknownDetailButtons').classList.add('hidden');
            document.getElementById('knownDetailButtons').classList.add('hidden');
            // æ¢å¤ä¸»æŒ‰é’®å¯èƒ½ä¸æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºé€šå¸¸åªæœ‰ goToNextWord ä¼šè°ƒç”¨ hideDetail å¹¶ç´§æ¥ç€ loadNextWord
        }

        async function loadDictionary(word) {
            try {
                const res = await fetch(`/api/dict/${encodeURIComponent(word)}`);
                if (!res.ok) {
                    showDictError();
                    speakWord();
                    return;
                }
                const data = await res.json();

                document.getElementById('phonetic').textContent = data.phonetic || '';

                if (data.translation && data.translation.length > 0) {
                    let defHtml = '';
                    data.translation.forEach(t => {
                        defHtml += `<p class="text-slate-200 text-base mb-2">${t}</p>`;
                    });
                    document.getElementById('definitionArea').innerHTML = defHtml;
                } else {
                    showDictError();
                }

                if (data.example) {
                    document.getElementById('exampleText').textContent = data.example;
                    document.getElementById('exampleArea').classList.remove('hidden');
                }

                speakWord();

            } catch (error) {
                showDictError();
                speakWord();
            }
        }

        function showDictError() {
            document.getElementById('definitionArea').innerHTML = `
                <div class="text-slate-400 text-sm">æœªæ‰¾åˆ°é‡Šä¹‰</div>
            `;
        }

        // æ ‡è®°ä¸ºè®¤è¯† (ç§»å‡ºé”™è¯æœ¬)
        async function markKnown() {
            if (!currentWord) return;
            sessionKnownCount++;

            try {
                const res = await fetch('/api/mistakes/known', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ wordId: currentWord.id })
                });

                if (!res.ok) throw new Error('æ“ä½œå¤±è´¥');

                showDetail(true);
            } catch (e) {
                alert('ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•æ ‡è®°ä¸ºè®¤è¯†');
            }
        }

        // æ ‡è®°ä¸ºä¸è®¤è¯† (ä¿æŒåœ¨é”™è¯æœ¬)
        async function markUnknown() {
            if (!currentWord) return;
            sessionUnknownCount++;
            // å·²ç»æ˜¯é”™è¯æ¨¡å¼ï¼Œä¸éœ€è¦é¢å¤–è°ƒç”¨APIæ·»åŠ ï¼Œåªéœ€è¦å±•ç¤ºè¯¦æƒ…
            showDetail(false);
        }

        // è®°é”™äº† (åŸæœ¬ä»¥ä¸ºè®¤è¯†ï¼Œå®é™…ä¸è®¤è¯† -> é‡æ–°ç¡®ä¿å®ƒåœ¨é”™è¯æœ¬)
        async function markAsMistake() {
            if (!currentWord) return;
            sessionKnownCount--;
            sessionUnknownCount++;

            try {
                // é‡æ–°åŠ å…¥é”™è¯æœ¬
                await fetch('/api/study/unknown', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ wordId: currentWord.id })
                });

                goToNextWord();
            } catch (e) {
                alert('åŠ å…¥é”™è¯æœ¬å¤±è´¥');
            }
        }

        async function goToNextWord() {
            sessionCount++;

            const card = document.getElementById('detailCard');
            card.classList.add('slide-out-left');

            // å¦‚æœæ˜¯ä¸è®¤è¯†æ¨¡å¼ï¼Œè¡¨ç¤ºæ²¡å­¦ä¼šï¼Œéœ€è¦è·³è¿‡(ä¸‹æ²‰)
            if (!isKnownMode) {
                try {
                    await fetch('/api/mistakes/skip', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ wordId: currentWord.id })
                    });
                } catch (e) {
                    console.error('Skip failed', e);
                    // å¤±è´¥ä¹Ÿä¸å½±å“æµç¨‹ï¼Œç»§ç»­ä¸‹ä¸€è¯
                }
            }

            setTimeout(() => {
                card.classList.remove('slide-out-left');
                // éšè—è¯¦æƒ…
                hideDetail();

                loadNextWord();
            }, 300);
        }

        function showCompleted() {
            document.getElementById('wordCard').classList.add('hidden');
            document.getElementById('detailCard').classList.add('hidden');
            document.getElementById('actionButtons').classList.add('hidden');
            document.getElementById('unknownDetailButtons').classList.add('hidden');
            document.getElementById('knownDetailButtons').classList.add('hidden');

            // Show batch completed UI but with All Done message
            showBatchCompleted();
            document.querySelector('#completedCard h2').textContent = 'ğŸ‰ é”™è¯æœ¬å·²æ¸…ç©ºï¼';

            // éšè— "ç»§ç»­åˆ·" æŒ‰é’®ï¼Œå› ä¸ºæ²¡è¯äº†
            const continueBtn = document.querySelector('button[onclick="continueNextBatch()"]');
            if (continueBtn) continueBtn.classList.add('hidden');
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        async function checkAuth() {
            try {
                const res = await fetch('/api/check-auth');
                const data = await res.json();
                if (!data.authenticated) {
                    window.location.href = '/';
                }
            } catch (e) {
                console.error('Auth check failed', e);
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(e => console.log(e));
                document.getElementById('fullscreenIcon').textContent = 'fullscreen_exit';
            } else {
                document.exitFullscreen();
                document.getElementById('fullscreenIcon').textContent = 'fullscreen';
            }
        }

        document.addEventListener('fullscreenchange', () => {
            const icon = document.getElementById('fullscreenIcon');
            if (document.fullscreenElement) {
                icon.textContent = 'fullscreen_exit';
            } else {
                icon.textContent = 'fullscreen';
            }
        });

        // åˆå§‹åŒ–
        checkAuth().then(() => {
            console.log('App Initialized, Loading First Word...');
            loadNextWord();
        });

    </script>
</body>

</html>